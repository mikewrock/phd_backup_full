\chapter{Trajectory Generation}
\label{chap:traj}

\section{Requirements of the Trajectory}
\label{sec:four}
Trajectory generation is used for two tasks that have very different applications but very similar execution. The purpose of the scanning task is to position a shielded radiation detector along the surface of the mine to determine ore concentration, while the shotcreting task is to apply shotcrete to the mine surface. Though the tasks and their purpose differ, their needs are the same. Both tasks require the manipulator to position itself orthogonal to the mine surface, execute a motion that maintains a certain distance from the mine, and cover a specified region. Figure \ref{fig:idealspray} shows the trajectory that would be required to scan or shotcrete a flat square.\\

\clearpage
\begin{figure}
    \centering
    \includegraphics[width=0.7\textwidth]{Pics/optimal.png}
    \caption{Trajectory Generation Template}
    \label{fig:idealspray}
\end{figure}
To be functional as a trajectory generation algorithm for both scanning and shotcreting, some parameters of the generated trajectory must be easily changed. This is accomplished through the use of configuration files and the \node{rqt_reconfigure} node. The configuration files contain the specifications that are used each time a trajectory is generated. They can be edited by the user and shared among multiple systems. If they need to be changed during runtime or modified for a single use, the \acrshort{gui} provided by the \node{rqt_reconfigure} node (shown in Fig. \ref{fig:dyngui}) allows the user to quickly and easily modify the parameters. Two of the main parameters can be seen in Figure \ref{fig:idealspray}: \var{step_height} and \var{via_distance}. As well, a third main parameter is the offset from the surface. Finally, the selection width and height can be specified by the user or left for the system to determine automatically. If no area is selected for scanning or shotcreting, a region next to the robot is selected with a size that is optimal for the manipulator's workspace. The control system uses the location of the default scan and shotcrete region when autonomously positioning itself to scan or shotcrete the next section of the mine such that it will not miss any sections.\\

\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{Pics/dyngui.png}
    \caption{\texttt{rqt\_reconfigure} \acrshort{gui}}
    \label{fig:dyngui}
\end{figure}

Specifically for shotcrete, the sprayer distance from the surface and angle relative to it are of the highest importance. Optimal distance and orientation maximizes the amount of adhesion and minimizes rebound  \cite{spraypat}. When the sprayer is too far away from the surface, not enough shotcrete sticks to the surface and when the sprayer is too close, shotcrete will bounce off the surface. In both cases, either shotcrete is wasted or the applied layer is of insufficient thickness. The former is uneconomical and the latter is unsafe. Similarly, the amount of rebound is related to the amount the sprayer is off from the ideal 90\degree\hspace{0pt} angle to the surface. The importance of choosing an appropriate radius at which to calculate the surface normal is illustrated in Figure \ref{fig:vianorm}. The height step and surface offset is determined by the amount of spread from the shotcrete spray nozzle, shotcrete composition, pressure, and flow rate.\\
\clearpage
\begin{figure}[h]
    \centering
    \includegraphics[width=.8\textwidth]{Pics/viapts3.pdf}
    \caption{Effect of Surface Normal Calculation Radius}
    \label{fig:vianorm}
\end{figure}

The scanning configuration is dependant on the shielding used with the radiation sensor. In an effort to improve current techniques, shielded detectors will be used to measure a precise region and avoid detecting energy from the surrounding ore. The sensor will detect a conical area in the direction it is facing. The shape of the cone is dependant on the sensor and shielding used. The surface offset for radiation scanning is determined by how detailed of a scan the operator wants from the mine surface. Offset can be increased to scan a larger region or complete the area scan faster, or decreased to measure smaller regions and achieve higher resolution. Step height can be determined to ensure full coverage with no overlap or can be increased to reduce scanning time by not scanning the entirety of the selected area.\\
\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/nonopt.png}
    \caption{Trajectory Overlaid on Mine Surface. Via Points for Angle Shown in Green, Distance in Blue, and Missing Points in Red}
    \label{fig:unidealspray}
\end{figure}

The via points and via distance allow the robot to follow the uneven surface of the mine. In the example shown in Figure \ref{fig:idealspray}, there is no need for via points at locations along the straight lines, but when the image is overlaid on the mine surface as shown in Figure \ref{fig:unidealspray}, the need for via points becomes apparent. The red circles highlight areas where additional via points are required to maintain optimal distance. The blue circles show the via points that help to maintain optimal distance, and the green circles show the via points used to achieve optimal angle. The via distance is the amount of space between via points and is set by the user. Determining the via distance requires knowledge of how rough the surface is likely to be, a parameter that would likely remain constant throughout the region in which the MASS is used. In extreme cases, via points can be calculated at every data point measured by the scanner. However, such high via point density leads to longer computation time and can become detrimental to the accuracy of the shotcrete application. Figure \ref{fig:viapts} shows how choosing too high a via point density leads to a convoluted spray path that may be less effective than a lower via point density. The diagram demonstrates the efficacy of using wider via point spacing. When the finer spacing was used, the additional via points caused the sprayer to move along a trajectory that is unnecessarily complex. In practice, small obtrusions on the mine surface are better ignored than attempting to orient the sprayer orthogonally to the surface at every point.\\

\begin{figure}[h]
    \centering
    \includegraphics[width=.9\textwidth]{Pics/viapts2.pdf}
    \caption{Effect of Via Point Spacing}
    \label{fig:viapts}
\end{figure}

\section{Techniques for Generating Trajectories}
Though it is a simple pattern, generating the trajectory shown in Figure \ref{fig:idealspray} on an uneven surface such as those found in a mine drift is not a simple task. In \cite{fully} the authors offered two approaches to generating shotcrete trajectories. Their first approach was termed semi-autonomous and relies on the user defining the trajectory while the robot executes it autonomously. The fully automated approach does not take in to account the surface it is applying shotcrete to, but simply moves along a pre-programmed path similar to the one shown in Figure \ref{fig:idealspray}. In reality, the pattern is to be generated on a surface that may contain sections in front, above, beside, or angled relative to the robot. The research in \cite{steal} positions the nozzle normal to the surface, however, it relies on the design profile of the tunnel to generate spray trajectories and normal vectors rather than using a 3D scan of the mine environment. The authors of \cite{artd} use \acrshort{lidar} scans to position the spray nozzle but not to generate spray trajectories. The work presented does not only generate trajectories in which the spray nozzle remains normal to the surface, but also generates trajectories that follow the contour of the mine surface without requiring detailed knowledge of its design profile. As well, if the shotcrete area is larger than the manipulator's workspace, the robot will autonomously re-position itself.\\

\subsection{Flattening Approach}
One attractive solution to generating a 2D trajectory on a 3D surface is to convert the 3D surface to a 2D surface through a flattening process. Earth has been represented on flat surfaces many times throughout history, but all projections distort the original in some way. Most often either the shapes are distorted but the scale remains the same or the shape is maintained and the scales distorted. A summary of flattening approaches can be found in \cite{overflat}, in which the authors divide the approaches into two categories: geometric and mechanical methods. The classic geometry flattening method is called the ``Triangular Patches Flattening Method'' where the Non-Uniform Rational B-Spline (\acrshort{nurbs}) surface is represented using a mesh of quadrilaterals that can each be subdivided into two triangles. The corners of the quadrilaterals are called nodes and the nodes are mapped to the 2D surface using the principal of increasing inner angle. The mechanical methods treat the connection between each node as a spring and try to minimize the energy of the surface as it is flattened, thus reducing the amount of distortion during the flattening process. \acrshort{nurbs} surfaces are not always flattenable, so the ``Flattenable Laplacian Mesh'' is presented in \cite{toward} as an alternative mesh representation and the local flattenable perturbation approach is discussed explaining how such a mesh is flattened.\\

Flattening approaches are often used when clothing or sheet metal objects are manufactured from cut pieces of flat material. The ``Woven Cloth'' approach is well discussed in \cite{woven,freef}, using a mechanical flattening method where the cloth's weft (horizontal) and warp (vertical) fibres are considered in-extensible but the angle between them flexible. Further energy based approaches are explored in \cite{parameet} where popular methods are compared to an angle and area energy based technique. Woven cloth techniques often produce discontinuities like cuts or overlapping folds, which may be suitable for clothing design but causes unpredictable shotcrete spray trajectories.\\

Though there are many approaches to flattening surfaces, nearly all result in some form of distortion. The distortion can cause the spray trajectories to leave unsatisfactory shotcrete thickness, either too much or too little. Specific feature curves can be chosen such that they are not distorted, as presented in \cite{wwarp,wwarpp}, however, that would require the same amount of operator instruction as manually selecting the shotcrete spray path.\\

\subsection{Microscopic Approach}

An ant crawling along the mine surface would experience it as a 2D surface. Though the ant is moving in three dimensions, it only has two positional degrees-of-freedom. When trajectory generation is reduced to microscopic sizing, the problem becomes one of path planning. To generate a trajectory like that in Figure \ref{fig:idealspray}, the ant simply needs to walk \var{selection_width}, make a 90\degree\hspace{0pt} turn, walk \var{step_height}, and make another 90\degree\hspace{0pt} turn. The ant can then alternate directions and repeat until it has covered the entire selection area. The two challenges with this approach is travelling in a straight line across the surface and turning 90\degree\hspace{0pt}.\\

\begin{figure}[h!]
    \centering
    \includegraphics[width=\textwidth]{Pics/ant.png}
    \caption{Determining Via Points Using Microscopic Path Planning}
    \label{fig:ant}
\end{figure}

For testing purposes, the algorithm assumes the selection area begins on a vertical section. While this is a reasonable assumption to make, had this technique been implemented in the final trajectory generation algorithm the surface normal at the start of the selection area would be used to determine an appropriate direction for the trajectory to begin with. With the vertical wall assumption, the second via point ($\mathbf{P}_2$) is simply constrained to be within the same vertical height as the first via point ($\mathbf{P}_1$) and via distance away within the selected area. The third and all subsequent via points ($\mathbf{P}_3,\mathbf{P}_4$) are calculated by moving the via distance amount along the vector created by the previous two via points ($\mathbf{V}_{12}\hspace{4pt} = \mathbf{P}_1\mathbf{P}_2\hspace{4pt} \& \hspace{4pt}\mathbf{V}_{23} = \mathbf{P}_2\mathbf{P}_3$). The actual via point is found using \acrshort{pcl}'s  nearest neighbour search in the area of the expected via point. At the edge of the selection area the 90\degree\hspace{0pt} turn must be made. The direction vector to the expected point ($\mathbf{V}_{45}$) is calculated using the cross product of the vector from the previous point ($\mathbf{V}_{34}$) with the vector of the surface normal at the current point ($\mathbf{N}_4$). The next expected via point location is then determined using that direction vector ($\mathbf{V}_{45} = \mathbf{V}_{34} \times \mathbf{N}_4$) and the step height. The same steps are taken for the next 90\degree\hspace{0pt} turn ($\mathbf{V}_{56} = \mathbf{V}_{45} \times \mathbf{N}_5$), then the path continues horizontally until reaching the starting edge of the selection area. A diagram illustrating this method is shown in Figure \ref{fig:ant}.\\


Since the robot is able to detect areas of insufficient shotcrete thickness, this method is viable, however, in practice it did not consistently yield a satisfactory trajectory. An example trajectory using this method is shown in Figure \ref{fig:anttraj}. Though the path does not fail entirely, the problems become evident - via points are not sufficiently constrained to vertical and horizontal paths. The direction vectors proved unreliable, so to test the algorithm in a best-case scenario, the selected area was chosen to be mostly vertical and the direction vectors were replaced with horizontal vectors. The direction vectors shown in red, surface normals in blue, and end-effector path in green show how the nearest neighbour search and expected via points approach causes the spray trajectory to become uneven.\\
\clearpage
\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/anttraj.png}
    \caption{Trajectory Generated Using Microscopic Path Planning}
    \label{fig:anttraj}
\end{figure}

\subsection{Plane Intersections}

One simple technique to generate a shotcrete trajectory is to calculate the intersection between a horizontal plane and the surface. Though the robot may not be on a level surface, it can use its built in Inertial Measurement Unit (\acrshort{imu}) to determine its orientation with respect to gravity and determine a level plane. By using the \func{cropbox} function of the \acrshort{pcl} library the software can inflate the plane to a rectangular prism of a desired thickness and crop all surface data points that do not lie within the box. Using the crop box approach reduces computation time since it eliminates the need to form a mesh of the mine surface and calculate the intersection between the mesh and a plane. Moving the crop box by the user specified step height allows the algorithm to generate a series of lines across the detected surface. These lines can then be sorted and downsampled to produce the via points necessary for a trajectory. If the surfaces to be scanned or sprayed were all vertical this technique would be simple and effective, however, when applying it to angled or horizontal sections the algorithm may fail. Figure \ref{fig:hplanes} shows how using non-vertical planes fails when applied to horizontal surfaces due to the crop box approach generating wider lines than desired (note the uppermost intersection). As well, the step height measured along the surface will not be correct, since the step height was measured along the vertical axis of the robot.\\

\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{Pics/hplanes.png}
    \caption{Horizontal Plane Intersections}
    \label{fig:hplanes}
\end{figure}
The next technique investigated was keeping the plane centred on the robot and rotating around the robot's axes as shown in Figures \ref{fig:pitchroll} and \ref{fig:yawplane}. Once again, using a fixed step angle will not yield a consistent step height. Moreover, the lines will converge at a point on a non-orthogonal wall. Consistent step height can be achieved by sorting the points on a line and determining the distance along the surface, then calculating the angle from the robot centre to the point at the appropriate step height. Using that angle, the plane can be rotated by the appropriate amount to yield consistent and accurate step heights, but the converging patterns cannot be avoided. If the crop plane is centred on a point on the mine surface and rotated to an angle normal to the surface, some converging lines disappear but the overall trajectory is still insufficient as shown in Figure \ref{fig:nplanes}. \\

\begin{figure}[h]
    \centering
    \includegraphics[width=.95\textwidth]{Pics/pitchroll.png}
    \caption{Pitch and Roll Plane Intersections}
    \label{fig:pitchroll}
\end{figure}   
\clearpage
\begin{figure}[H]
    \centering
    \includegraphics[width=.95\textwidth]{Pics/yawlines.png}
    \caption{Yaw Plane Intersections}
    \label{fig:yawplane}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=.95\textwidth]{Pics/nlines.png}
    \caption{Normal-to-Surface Plane Intersections}
    \label{fig:nplanes}
\end{figure}
\clearpage

\subsubsection{Measuring Distance Along the Surface}

In this work, a sorted line is a line of points which are sorted by distance measured along the surface on which they lie. To produce a sorted line, first the line is extracted using a plane intersection as shown in Figure \ref{fig:vline}. The beginning of the line is determined by finding the point with the lowest vertical height. The nearest neighbour search is used to find the next closest point and the distance between the two points is calculated. Each successive point's distance is added to the cumulative point-to-point distance so that each point contains the distance from that point to the first point, travelling through each point along the way. Choosing the plane on which to extract points can be arbitrary, but if it is not vertical, the end points of the line are determined by finding the two furthest points along the line. Ideally the vertical line would be one dimensional, but since the crop box technique was used, the line can have a width of a few data points.
\begin{figure}[!htb]
    \centering
    \includegraphics[width=\textwidth]{Pics/vline.png}
    \caption{Single Line from Plane Intersection}
    \label{fig:vline}
\end{figure}
\clearpage
One of the problems with sorting the vertical line using nearest neighbours is that some points may be missed entirely. The missed points are then added once the line is complete, forming a sorted line similar to the one shown in Figure \ref{fig:sline}. In the figure, the point distance is represented by colour, red being the smallest, then yellow, green, blue, purple, and pink. The points ranging from blue through pink are all extra points that should have been ignored or used in the initial calculations. As well, when too many points are used, the cumulative distance is longer than the true surface distance. Figure \ref{fig:inset} highlights a small portion of a larger section of a sorted line. Figure \ref{fig:meandering} shows how using the nearest neighbour approach can miss points and how it takes a much longer path than necessary. Figure \ref{fig:downsampledpath} shows how down-sampling the data allows the surface distance to approach a value much closer to the true value by ignoring all points within a certain radius of the accepted points. \\

\begin{figure}[H]
    \centering
    \includegraphics[angle=270,width=\textwidth]{Pics/sortedline.png}
    \caption{Sorted Line Failure}
    \label{fig:sline}
\end{figure}
Another error check performed when sorting a line is to ensure the distance between two points is not too far apart. Since Figure \ref{fig:inset} is only a section of a larger portion of a sorted line, the majority of the points are orange, indicating they were all sorted together. The purple points were not sorted when the algorithm initially passed through, but since the algorithm will continue until all the points have been sorted it will eventually return to them (though the distance will be significantly larger due to each point storing the cumulative distance travelled). To avoid this case, a maximum distance between sorted points is set such that when the sorting algorithm reaches the end of the line it will not jump backwards to sort the remaining points it missed.\\

\begin{figure}[H]
    \centering
    \includegraphics[width=.8\textwidth]{Pics/inset.pdf}
    \caption{Large Portion of a Sorted Line}
    \label{fig:inset}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/sorting.pdf}
    \caption{Long Path Produced by Nearest Neighbour Approach}
    \label{fig:meandering}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/meandering.pdf}
    \caption{Improved Accuracy Using Downsampling}
    \label{fig:downsampledpath}
\end{figure}

\section{Algorithm Used for Trajectory Generation}


The final algorithm chosen for implementation uses a combination of the yaw plane intersections from Figure \ref{fig:yawplane} for the wall sections and the pitch/roll plane intersections from Figure \ref{fig:pitchroll} for the roof sections. To generate trajectories the algorithm uses the structure outlined in Algorithm \ref{alg:trajgen}.\\

\begin{algorithm}[H]
\caption{Trajectory Generation Algorithm}
\label{alg:trajgen}
\begin{algorithmic}[1]

    \State Extract horizontal plane intersection and sort line
    \State Extract vertical plane intersection and sort line
    \State Use horizontal line to generate vertical ribs with sorted points
    \State Use vertical line to generate horizontal ribs with sorted points
    \State Select first point of each vertical rib, calculate surface normal, apply offset, and store trajectory point
    \State Select a point \var{step_height} away from first point on each rib (in reverse order), calculate surface normal, apply offset, and store trajectory point
    \State Repeat Step 6 until trajectory points have been generated for all vertical ribs, alternating direction
    \State Repeat Steps 5-7 with horizontal ribs

\end{algorithmic}
\end{algorithm}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{Pics/trajtiles.png}
    \caption{Trajectory Generated (Top Left and Top Right) Showing Surface Path (Red), Offset Normals (Blue), End-Effector Path (Green), Downsampled Ribs (bottom left), and Rib Location Points (bottom right)}
    \label{fig:trajtiles}
\end{figure}
Figure \ref{fig:trajtiles} shows the final trajectory in the upper right. Steps 1-2 can be seen in the bottom right, Steps 3-4 in the bottom left, and the surface path in the upper left. It should be noted the spray head will be instructed to shut off while it is moving from the final trajectory point of the wall section to the initial trajectory point of the roof section.\\

\subsection{Extracting Plane Intersections}

Steps 1-2 of the algorithm require extracting a vertical and horizontal plane intersection. The height of the horizontal plane can be set using the \var{mid_height} parameter. The vertical plane is centred on the robot. The thickness of the plane is set using the \var{slice_thickness} parameter. Once extracted, the line of points is sorted and points that are \var{via_distance} apart are used as locations to calculate ribs. The horizontal and vertical plane intersection lines after their points have been downsampled to \var{via_distance} apart can be seen as two, four-point lines in Figure \ref{fig:sortedintersections}. The final point of the sorted vertical line is not \var{via_distance} from the previous point, but is included to ensure the trajectory covers the entire selected area. This behaviour was chosen because additional shotcrete usage is preferred over missed areas.\\
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/genclosepts.png}
    \caption{Sorted and Downsampled Vertical and Horizontal Plane Intersections}
    \label{fig:sortedintersections}
\end{figure}

\subsection{Sorting Vertical and Horizontal Ribs}
\label{sec:sortlines}

At each point generated from the sorted vertical and horizontal plane intersections, a vertical or horizontal rib is generated as shown in Figure \ref{fig:ribs}. The ribs, receiving their name due to the similarity in appearance to a human rib cage, have their points sorted using the line point sorting algorithm. The spacing between points within a rib is determined by the \var{rib_downsampling} parameter. The maximum height of the wall section is defined using the \var{max_height} parameter. It does not need to be exact, but should approximate the height of the transition from a vertical wall section to a horizontal roof section. Trajectories for the curved sections between wall and roof sections can be generated with either vertical or horizontal ribs making exact determination of \var{max_height} not a necessity. Additional parameters to prevent trajectory generation failure and improve accuracy are \var{max_rib_length}, \var{z_vert_limit}, and \var{rib_tolerance}. The parameter \var{max_rib_length} limits the maximum length the rib can be. However, to ensure ribs are not unintentionally shortened, knowledge of the mine size and shape is required to fully utilize this parameter. To achieve more accurate coverage of the wall sections, \var{z_vert_limit} is used to define the vertical limit where exclusively $Z$-values are used to determine the point-to-point distance along the rib. This decision was made since an accurate \var{step_height} is more important for trajectories than the true surface distance. When sorting the rib points, it is possible the scanner may pick up erroneous data points from particulate in the air or unexpected objects in the work environment. These data points are usually significantly further away from the line of rib points, so any points further than \var{rib_tolerance} from the previous point is considered an outlier and ignored. The \var{rib_tolerance} parameter reduces the need for the \var{max_rib_length} value, so it is used when the operator has little knowledge of the mine dimensions.\\

\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/genclosejustribs.png}
    \caption{Sorted and Downsampled Vertical and Horizontal Ribs}
    \label{fig:ribs}
\end{figure}

\subsection{Selecting Trajectory Via Points}

Once the ribs have been generated and sorted the trajectory via points are selected to form the path shown in Figure \ref{fig:path}. Beginning with the vertical ribs, the first point of the first rib is selected. The surface normal is calculated at that point and the via point is offset from the surface along the surface normal by the amount defined in the configuration file. The orientation of the spray nozzle at each via point is determined as the negative value of the surface normal. Going through each rib in order, the first point of the rib is offset and added to the list of trajectory points. After the first point of each rib has been converted to a trajectory point, the same process is repeated using the ribs in reverse order. Rather then picking the first point on the rib, a point \var{step_height} away from the previous point is used to calculate the trajectory point. This process is repeated while alternating the order of ribs from which the points are selected until the trajectory reaches the top of the wall section that was defined by \var{max_height}. The process repeats itself for the ribs generated for the roof section to complete the trajectory generation as shown in Figure \ref{fig:path}.\\

\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/genclosepath.png}
    \caption{Path Generated Through Selecting Trajectory Via Points}
    \label{fig:path}
\end{figure}
\subsection{Advancing the Robot}

If the user selects an area to shotcrete that is outside the manipulator's workspace, it will autonomously navigate to an appropriate start position. Similarly, if the shotcrete area is larger than the manipulator's workspace, the robot base will move as necessary to ensure the entire selected area receives a shotcrete application. If no specific area is selected the system enters continuous operation mode, and will autonomously apply shotcrete to an area the size of its workspace, then move along the mine surface continually applying shotcrete until the operator instructs it to halt.\\

The robot determines an appropriate position for shotcreting by orienting itself parallel to the mine surface at a predetermined offset to maximize the area of the mine surface that is within the manipulator's workspace. If the initial pose of the robot is beyond the manipulator's reach, it will search the selection area for the closest point, navigate to an appropriate location, and begin the shotcrete process there. If the robot begins at a location close enough to the mine surface to begin shotcreting, it will start immediately. When it completes the area within its workspace, it crops the completed section from the selection area leaving only the parts that have not received shotcrete. With only the incomplete section of the selected area remaining, the system selects the nearest point as a goal location and repeats the shotcrete application process until the entire selected area is complete.\\

When advancing itself, the robot determines a location one half its workspace beyond the nearest point to it. By choosing a point further along the selected area it can minimize the number of times it has to move and maximize the amount of area it covers at each location. At the location it determines to be optimal, the surface normal is calculated and used to position the robot parallel to and offset from the mine surface.\\

\section{Chapter Summary}
This chapter discussed the method in which the MASS generates a trajectory for its manipulator to follow when performing scanning or shotcreting tasks. The main requirement for both scanning and shotcreting is to orient the end-effector perpendicular to the the mine surface. As well, the manipulator trajectory must maintain consistent and optimal distance from the mine surface and not miss any portion of the selected area. A \acrshort{lidar} scanner on a nodding head produces point clouds that are used as the input for the trajectory generation algorithm using sorted lines from horizontal and vertical plane intersections. The algorithm then generates a set of position and orientation via points that the manipulator must follow in order to perform the scanning or shotcreting task.\\