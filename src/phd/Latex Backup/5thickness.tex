\chapter{Thickness Estimation}
\label{chap:thick}
\section{Requirements of the Estimate}
Currently at the MacArthur River mine, sufficient shotcrete thickness is ensured using the operator's visual estimation. This is a single point of failure and requires a highly trained and experienced operator to be able to visually identify if the shotcrete is thick enough. Thickness verification is rarely done once operator training is completed. Providing a comprehensive and accurate thickness estimate will not only ensure safety while reducing material usage, but will reduce training time as well due to the rapid generation of graphical thickness estimates for the entire shotcrete surface. Using the autonomous functionality of the MASS, shotcrete application training can be eliminated.\\

Since the current method of thickness estimation has such low accuracy, the requirements for the automated system are fairly simple. Even the lowest accuracy method of thickness estimation investigated was significantly more accurate than the current technique. Though it is fairly simple to produce more accurate estimates than are currently available, it is the goal of this work to produce the most accurate estimates with the least amount of site specific tuning required. At the very least, each data point measured by the Light Detection and Ranging (\acrshort{lidar}) scanner should be converted to a thickness estimate. Interpolating between data points is not only computationally intensive, but generates thickness estimates at a resolution much higher than necessary. The methods proposed all provide significantly improved accuracy, but some require more tuning than others since many of the thickness estimation techniques involve the use of surface normals. Surface normals are calculated using the surrounding data points, so tuning involves choosing how large a portion of the surface to use when determining the surface normal. An appropriate radius for determining surface normals is based on the surface roughness and feature sizes as discussed in Section \ref{sec:four}. As well, using too many data points can lead to unnecessarily demanding computational needs so downsampling the point clouds may be necessary depending on the computing hardware used and the response time required to produce the estimate. Typical shotcrete layer thickness is 50 mm, so the goal chosen for thickness estimation accuracy is less than 5 mm.\\

\section{Techniques for Estimating Thickness}

There are many techniques to measure shotcrete thickness, which can be divided into destructive and non-destructive categories. Destructive testing means physically removing a section of the shotcrete until the ore is exposed and measuring the thickness of the applied shotcrete or driving an object into the shotcrete and measuring penetration depth and removal force. These methods can weaken the shotcrete layer, reducing its effectiveness, and if left unrepaired can become a source of radon gas leakage among other hazards. As well, destructive techniques only measure the thickness of the tested sections leaving no guarantee the untouched sections are of equal thickness. This method may be useful in evaluating an operator's effectiveness, but offers no assurance the entirety of the shotcreted surface is sufficiently thick.\\

Non-destructive techniques can cover the entirety of the shotcrete surface or be limited to small areas. Impact echo testing is an example of a non-destructive technique \cite{impact}, but only measures a single point at a time, making the measurement of the entire shotcrete surface tedious and impractical. Currently, the most robust measurement of shotcrete thickness can be achieved using \acrshort{lidar} or photogrammetry. These methods use optical measurements, both before and after applying shotcrete, and rely on software algorithms to calculate thickness estimates based on the measured data. The accuracy of these estimates are heavily dependant on the prior and posterior measurements being spatially aligned in the same coordinate frame. Any alignment inaccuracy translates directly to thickness estimation inaccuracy. For this reason, accurately aligning the two measurements is crucial for accurate results.\\

Photogrammetry is the use of photography for the purpose of surveying and mapping. By taking photos from multiple locations, images can be combined to produce 3D datasets. Knowing the location of where the images were taken, the images can be rectified like in a stereo camera system. Photogrammetry is not limited to camera photography and can include fusion of images and 3D point clouds \cite{photo1} as well as fusion of aerial and ground based images with \acrshort{lidar} scans \cite{photo2}. Without knowledge of the camera's location at the time of photographing, image analysis techniques can be used to find keypoints that allow software to reconstruct multiple images into a 3D environment. These techniques are excellent for open-pit mining and aerial surveying, but suffer greatly when lacking an adequate source of illumination such as the environment in an underground mine. Above ground techniques can use \acrshort{gps} for localization, but the \acrshort{gps} signals cannot be used in underground mines.\\

\acrshort{lidar} uses pulsed laser light to measure distances from the scanner. Using an internal rotating mirror, the laser can sweep about an axis and measure a cross section of data points. By mounting the scanner on a nodding head, a 3D reconstruction of the environment can be obtained. The data returned by the scanner is a series of measured points often called a point cloud due to its similarity in appearance to clouds. \acrshort{lidar} is much better suited for underground monitoring, since the technology incorporates its own light source. Internal software can be used to remove false readings from dust or water particles suspended in the air. The \acrshort{lidar} scanner not only records the spatial position of the data points, but their reflected intensity as well. It is the reflected light intensity that allows the registration algorithm presented herein to function. Without it, users would be limited to registration algorithms based on surface geometry alone, but much of the surface changes after applying shotcrete. When including intensity values in the \acrshort{lidar} measurements Abedini, et al. were able to identify seven to eight times as many keypoints than using range data alone \cite{reg1}.\\

\section{Registration}

In order to calculate the shotcrete thickness from point cloud scans taken before and after shotcreting they must be spatially aligned. The process of aligning the point clouds is called registration. Simply not moving the scanner during the shotcreting process eliminates the need for registration, however, this requires guaranteeing the robot does not move between scans. Registration algorithms align two point clouds into a common coordinate frame. These algorithms use some or all of the following steps: 

\begin{enumerate}
    \item Keypoint Identification
    \item Feature Description
    \item Correspondence Matching
    \item Transformation Estimation
\end{enumerate}

Keypoint identification involves selecting specific points in the dataset that fit a certain criteria. A good keypoint can be identified regardless of viewpoint, scale, and illumination. There are many ways of describing keypoint features such as \acrshort{narf} (Normal Aligned Radial Feature \cite{narf}), \acrshort{sift} (Scale Invariant Feature Transform \cite{sift}), and \acrshort{fast} (Features from Accelerated Segment Test \cite{fast}). Filipe and Alexandre provide an excellent summary and comparison of some of the popular keypoint detection methods\cite{keypoint}. Often occurring simultaneously, feature descriptors are calculated at each keypoint. This allows the correspondence matching algorithms to distinguish between keypoints, making each one (hopefully) unique. Since the purpose of keypoint identification and feature description is to decrease the size of the dataset, the correspondence matching can be brute forced or done using a nearest neighbour search like \acrshort{flann} (Fast Library for Approximate Nearest Neighbors \cite{flann}). The uniqueness of each keypoint helps eliminate false correspondences. Once a final correspondence is selected, a rigid transformation between the two scan locations is computed. The point clouds can then be aligned and the entire process can be repeated iteratively to improve accuracy.\\

In order to maximize the accuracy of registration, keypoints can be manually selected or placed within the field of view of the scanner. Objects placed in the field of view of an imaging system for reference purposes are known as fiducial markers. Fiducial markers can be specific shapes, orientations, colours, reflectivities, or any combination of the above. Without the use of fiducial markers, registration requires constant tuning and quality control \cite{reg3}. Morrison published a thesis testing a variety of shapes to be used as fiducial markers \cite{mark1}. Habib, et al. used straight lines that have been detected to generate keypoints \cite{key1}. Martinez-Sanchez, et al. trained a neural network to recognize rock bolts and used their locations as featureless keypoints to perform Iterative Closest Point (ICP) registration of point clouds from before and after shotcrete application \cite{reg2}.\\

Since the scanner in this research returns reflected intensity and mines have very few highly reflective areas, reflection based fiducial markers are very well suited for registration keypoints. Kukutsch, et al. used circular markers with high reflectivity that can pan and tilt without moving the centre of the marker \cite{mark2}. A fiducial marker based on two cylinders was able to be localized to within 7.5 mm in \cite{mark3}.\\

As discussed in Chapter \ref{chap:localiz}, localization is achieved through the use of fiducial markers. The localization of the robot eliminates the need for registration, since the point clouds can be spatially aligned using the location of the robot at the time it takes each scan. For this application, the localization method implemented is more accurate than any of the registration approaches tested and discussed.
\section{Thickness Estimation Methods}

With two registered point clouds, the distance between them represents the thickness of the applied shotcrete layer. Calculating the distance can be divided into three main categories, depending on how each point cloud is treated. In the Point-to-Point (\acrshort{p2p}) method the point clouds do not require further processing. The Point-to-Mesh (\acrshort{p2m}) method requires converting one of the point clouds to a mesh and the Mesh-to-Mesh (\acrshort{m2m}) approach requires converting both point clouds to meshes.\\

\subsection{Point-to-Point}
The \acrshort{p2p} approach shown in Figure \ref{fig:p2pdia} is the simplest yet most robust method for thickness estimation. If the initial and final point clouds are sufficiently dense, it can be the most accurate as well. The \acrshort{p2p} method loses accuracy when the surface scans have a significant amount of noise or low point density. Calculating the shotcrete thickness using \acrshort{p2p} is done using the nearest neighbour search method from the \acrshort{pcl} library. For each point in the source cloud, the nearest point in the target cloud is found. The distance between the two points is calculated and stored in the final point cloud used for thickness analysis. To achieve the best results, the denser point cloud should be used as the target cloud.\\
\label{sec:p2p}
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/p2p.pdf}
    \caption{Point-to-Point Thickness Estimation}
    \label{fig:p2pdia}
\end{figure}
\subsection{Point-to-Mesh}

The \acrshort{p2m} approach requires first generating a mesh of the final point cloud. The most common approach to forming a mesh from a set of points is Delaunay triangulation \cite{delaunay}. Using this method the points are grouped in threes to form a continuous surface of triangles. Slob and Hack divide surface reconstruction techniques into polygonal and parametric categories \cite{mesh1}. Polygonal techniques, like 3D Delaunay triangulation, use linear interpolation to create triangular patches between 3D points and can be used to fill gaps in the scan data \cite{mesh3}. Parametric techniques like \acrshort{nurbs} (Non-Uniform Rational B-Splines) or Fast \acrshort{rbf} (Radial Basis Functions) use parametric functions to define surface patches and generally yield more natural looking and accurate surface reconstructions \cite{mesh1}. Preprocessing of the point cloud to remove noise and outliers improves reconstruction as shown in \cite{mesh2}.\\
\label{sec:p2m}
\begin{figure}[h!]
    \centering
    \includegraphics[width=.8\textwidth]{Pics/p2m.pdf}
    \caption{Point-to-Mesh Thickness Estimation}
    \label{fig:p2mdia}
\end{figure}
\clearpage

Thickness calculation is done by finding the nearest point or edge in the source cloud for each point in the target cloud. The distance is then calculated using a normal vector to the source cloud triangle's plane that intersects the point in the target cloud. As can be seen in Figure \ref{fig:p2mdia}, if the surface meshing is performed at too high a resolution, the accuracy is significantly reduced. The original point cloud can be downsampled using averaging methods to yield a lower resolution point cloud, however, the process requires tuning specific to the surface features it is used upon. As well, different sections of the surface may have significantly different roughness requiring differing degrees of downsampling to yield optimal results.\\
\begin{figure}[h!]
    \centering
    \includegraphics[width=.8\textwidth]{Pics/p2mlocal.pdf}
    \caption{Point-to-Mesh Thickness Estimation Using Local Features}
    \label{fig:p2mlocaldia}
\end{figure}
\clearpage

To reduce the accuracy loss of using a single density for downsampling the point cloud, local features can be computed. Local features are computed by averaging a group of points to form a single plane using a method such as least squares. The least squares method attempts to find a plane having the least distance to each point in the local area. By computing local features, the accuracy loss shown in Figure \ref{fig:p2mdia} can be reduced to the scenario presented in Figure \ref{fig:p2mlocaldia}. Local features once again require knowledge of the surface roughness or scan specific tuning. The \acrshort{p2m} approaches can provide greater accuracy in low density point clouds than \acrshort{p2p} can offer, but they require tuning and calibration from the operator and an increased amount of computation time.\\
\subsection{Mesh-to-Mesh}
The \acrshort{m2m} approaches are the most computationally intensive methods and have the highest sensitivity to computation parameter selection. Both point clouds, initial and final, will have different surface roughness and require individual site specific tuning. In \acrshort{m2m}, the midpoint of the line (or centroid of the triangle) formed by the meshing of the source point cloud is used as the location to calculate a thickness measurement. The orthogonal distance from the line (or surface) of the source mesh to the intersection with the line (or surface) of the target mesh is used as the thickness estimate. Similar to \acrshort{p2m}, \acrshort{m2m} requires specific tuning to ensure the point clouds are accurately represented as meshes. A visual representation of the \acrshort{m2m} approach is shown in Figure \ref{fig:m2mdia}.\\
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/m2m.pdf}
    \caption{Mesh-to-Mesh Thickness Estimation}
    \label{fig:m2mdia}
\end{figure}
\clearpage
\subsection{Multiscale Model-to-Model Cloud Comparison}

Multiscale Model-to-Model Cloud Comparison (\acrshort{m3c2}) is visually summarised in Figure \ref{fig:m3c2} and presented in \cite{thick2}. This approach is similar to the local feature \acrshort{p2m} approach in which local areas of the point cloud are averaged to generate planes whose normals are used for thickness estimation. The accuracy loss from choosing an inappropriate scale at which to calculate local surface normals is shown in Figure \ref{fig:m3c2}(b). Though \acrshort{m3c2} is also dependant on site specific calibration, the user is able to specify a confidence value for the accuracy of the surface scans ($\sigma_1,\sigma_2$) with the algorithm producing a confidence value for each thickness estimate.\\

\begin{figure}[h!]
    \centering
    \includegraphics[width=\textwidth]{Pics/m3c2.png}
    \caption{Multiscale Model-to-Model Cloud Comparison \cite{thick1}}
    \label{fig:m3c2}
\end{figure}
\section{Method Implemented for Estimating Thickness}
Ultimately, the user is free to use alternate methods of thickness estimation. Every point cloud obtained by the MASS is localized to a common coordinate frame, making it simple to use external software for point cloud comparison. CloudCompare (https://www.cloudcompare.org/) is an open source 3D point cloud and mesh processing software that can use the output files generated by the MASS without the need for converting or preprocessing the data. CloudCompare allows the user to calculate shotcrete thickness using a number of different approaches, with whatever computation parameters they choose.\\

For the specific scenario the MASS was designed to simulate, \acrshort{p2p} was determined to be the best approach. It requires the least amount of user input and provides the highest accuracy for the given test conditions. Though CloudCompare provides an external solution for \acrshort{p2p} thickness estimation, in the interest of providing a complete package, the \acrshort{p2p} algorithm was integrated into the MASS software package. Future research in which novel thickness estimation techniques are developed can be integrated directly into the MASS software package or developed as a standalone service. The user can view and interact with the thickness estimates within the RViz environment using the MASS software package. Due to the modularity of \acrshort{ros}, alternate thickness estimation algorithms can be selected by launching an alternate thickness estimation service either manually or within the \acrshort{ros} launch file.\\
\section{Chapter Summary}
This chapter presented the techniques explored and the method chosen for determining the thickness of an applied shotcrete layer. The requirements of the thickness estimate was discussed followed by a summary of the approaches one can take to measure shotcrete thickness using the data provided by the MASS. Ultimately two methods were implemented and tested, the point-to-point (\acrshort{p2p}) approach and point-to-mesh (\acrshort{p2m}) approach. It was found the difference in accuracy was minimal, so the \acrshort{p2p} method was chosen due to the fact it required less tuning of parameters.\\