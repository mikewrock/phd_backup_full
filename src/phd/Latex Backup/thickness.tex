\chapter{Thickness Estimation}
\label{chap:thick}
\section{Chapter Overview}
This chapter presents the techniques explored and the method chosen for determining the thickness of an applied shotcrete layer. The requirements of a thickness estimate is discussed followed by a summary of the approaches one can take to measure shotcrete thickness using the data provided by the MASSS. Ultimately two methods were implemented and tested, the point-to-point (P2P) and point-to-mesh (P2M). It was found the difference in accuracy was minimal, so the P2P method was chosen due to its reduced situation dependant tuning parameters.\\
\section{Requirements of the Estimate}
Currently at the MacArthur River mine sufficient shotcrete thickness is ensured using the operator's visual estimation. This is a single point of failure and requires a highly trained and experienced operator to be able to visually identify whether the shotcrete is thick enough with thickness verification rarely done once operator training is completed. Providing a comprehensive and accurate thickness estimate will not only ensure safety while reducing material usage, but will reduce training time as well due to the rapid production of graphically represented thickness estimates covering the entire shotcrete surface.\\

Since the current method of thickness estimation has such low accuracy, the requirements are fairly simple. Even the lowest accuracy method of thickness estimation is significantly more accurate than the current technique. Though it is fairly simple to produce more accurate estimates than are currently available, it is the goal of this work to produce the most accurate estimates with the least amount of site specific tuning required. At the very least, each data point measured by the LIDAR scanner should be converted to a thickness estimate. Interpolating between data points is not only computationally intensive, but generates thickness estimates at a resolution much higher than necessary. The methods proposed all provide significantly improved accuracy, but some require more tuning than others since many of the thickness estimation techniques require the use of surface normals. Surface normals are calculated using the surrounding data points, so tuning involves choosing how large a portion of the surface to use when determining the surface normal. An appropriate radius for determining surface normals is based on the surface roughness and feature sizes. As well, using too many data points can lead to unnecessarily demanding computational needs so downsampling the pointclouds may be necessary depending on the computing hardware used and the response time required to produce the estimate.\\

\section{Techniques for Estimating Thickness}

There are many techniques to measure shotcrete thickness, which can be divided into destructive and non-destructive categories. Destructive testing means physically removing a section of the shotcrete until the ore is exposed and measuring the thickness of the applied shotcrete. This method can weaken the shotcrete layer, reducing its effectiveness, and if left unrepaired can become a source of toxic gas leakage among other hazards. As well, destructive techniques only measure the thickness of the removed sections leaving no guarantee the untouched sections are of equal thickness. This method may be useful in evaluating an operator's effectiveness, but offers no assurance the entirety of the shotcreted surface is sufficiently thick.\\

Non-destructive techniques can cover the entirety of the shotcrete surface or be limited to small areas. Impact echo testing is an example of a non-destructive technique\cite{impact}, but only measures a single point at a time, making the measurement of the entire shotcrete surface tedious and impractical. Currently, the most robust measurement of shotcrete thickness can be achieved using LIDAR or photogrammetry. These methods use optical measurements, both before and after applying shotcrete, and rely on software algorithms to calculate thickness estimates based on the measured data. The accuracy of these estimates are heavily dependant on the prior and posterior measurements being spatially aligned in the same coordinate frame. Any alignment inaccuracy translates directly to thickness estimate inaccuracy. For this reason, accurately aligning the two measurements is crucial for accurate results.\\

There are many techniques to measure shotcrete thickness, which can be divided into destructive and non-destructive categories. Destructive testing means physically removing a section of the shotcrete until the ore is exposed and measuring the thickness of the applied shotcrete. This method can weaken the shotcrete layer, reducing its effectiveness, and if left unrepaired can become a source of toxic gas leakage among other hazards. As well, destructive techniques only measure the thickness of the removed sections leaving no guarantee the untouched sections are of equal thickness. This method may be useful in evaluating an operator's effectiveness, but offers no assurance the entirety of the shotcreted surface is sufficiently thick.\\

Non-destructive techniques can cover the entirety of the shotcrete surface or be limited to small areas. Impact echo testing is an example of a non-destructive technique\cite{impact}, but only measures a single point at a time, making the measurement of the entire shotcrete surface tedious and impractical. Currently, the most robust measurement of shotcrete thickness can be achieved using LIDAR or photogrammetry. These methods use optical measurements, both before and after applying shotcrete, and rely on software algorithms to calculate thickness estimates based on the measured data. The accuracy of these estimates are heavily dependant on the prior and posterior measurements being spatially aligned in the same coordinate frame. Any alignment inaccuracy translates directly to thickness estimate inaccuracy. For this reason, accurately aligning the two measurements is crucial for accurate results.\\

Photogrammetry is the use of photography for the purpose of surveying and mapping. By taking photos from multiple locations, images can be combined to produce 3D datasets. Knowing the location of where the images were taken, the images can be rectified like in a stereo camera system. Photogrammetry is not limited to camera photography and can include fusion of images and 3D point clouds \cite{photo1} as well as fusion of aerial and ground based images with LIDAR scans \cite{photo2}. Without knowledge of the camera's location at the time of photographing, image analysis techniques can be used to find keypoints that allow software to reconstruct multiple images into a 3D environment. These techniques are excellent for open-pit mining and aerial surveying, but suffer greatly when lacking an adequate source of illumination such as the environment in an underground mine. Above ground techniques can use GPS for localization, but the GPS signals cannot be used in underground mines.\\

Light Detection and Ranging (LIDAR) uses pulsed laser light to measure distances from the scanner. Using an internal rotating mirror, the laser can sweep about an axis and measure a cross section of data points. By mounting the scanner on a nodding head, a 3D reconstruction of the environment can be obtained. The data returned by the scanner is a series of measured points often called a ``point cloud'' due to its similarity in appearance to clouds. LIDAR is much better suited for underground monitoring, since the technology incorporates its own light source. Internal software can be used to remove false readings from dust or water particles suspended in the air. The LIDAR not only records the spatial position of the data points, but their reflected intensity as well. It is the reflected light intensity that allows the registration algorithm presented herein to function. Without it, users would be limited to registration algorithms based on surface geometry alone, but much of the surface changes after applying shotcrete. When including intensity values in the LIDAR measurements Abedini, et al. were able to identify 7-8x as many keypoints than using range data alone \cite{reg1}.\\

\section{Registration}

In order to calculate the shotcrete thickness from pointcloud scans taken before and after shotcreting they must be spatially aligned. The process of aligning the pointclouds is called registration. Simply not moving the scanner during the shotcreting process eliminates the need for registration, however, this may not be an option for a variety of reasons. Registration algorithms align two point clouds into a common coordinate frame. These algorithms use some or all of the following steps: 

\begin{enumerate}
    \item Keypoint Identification
    \item Feature Description
    \item Correspondence Matching
    \item Transformation Estimation
\end{enumerate}

Keypoint identification involves selecting specific points in the dataset that fit a certain criteria. A good keypoint can be identified regardless of viewpoint, scale, and illumination. There are many ways of describing keypoint features such as NARF (Normal Aligned Radial Feature \cite{narf}), SIFT (Scale Invariant Feature Transform \cite{sift}), and FAST (Features from Accelerated Segment Test \cite{fast}). Filipe and Alexandre provide an excellent summary and comparison of some of the popular keypoint detection methods\cite{keypoint}. Often occurring simultaneously, feature descriptors are calculated at each keypoint. This allows the correspondence matching algorithms to distinguish between keypoints, making each one (hopefully) unique. Since the purpose of keypoint identification and feature description is to decrease the size of the dataset, the correspondence matching can be brute forced or done using a nearest neighbour search like FLANN (Fast Library for Approximate Nearest Neighbors \cite{flann}). The uniqueness of each keypoint helps eliminate false correspondences. Once a final correspondence is selected, a rigid transformation between the two scan locations is computed. The point clouds can then be aligned and the entire process can be repeated iteratively to improve accuracy.\\

In order to maximize the accuracy of registration, keypoints can be manually selected or placed within the field of view of the scanner. Objects placed in the field of view of an imaging system for reference purposes are known as fiducial markers. Fiducial markers can be specific shapes, orientations, colours, reflectivities, or any combination of the above. Without the use of fiducial markers, registration requires constant tuning and quality control \cite{reg3}. Morrison published a thesis testing a variety of shapes to be used as fiducial markers \cite{mark1}. Habib, et al. used straight lines that have been detected to generate keypoints \cite{key1}. Martinez-Sanchez, et al. trained a neural network to recognize rock bolts and used their locations as featureless keypoints to perform Iterative Closest Point (ICP) registration of point clouds from before and after shotcrete application \cite{reg2}.\\

Since the scanner in this research returns reflected intensity, and mines have very few highly reflective areas, reflection based fiducial markers are very well suited for registration keypoints. Kukutsch, et al. used circular markers with high reflectivity that can pan and tilt without moving the centre of the marker \cite{mark2}. A fiducial marker based on two cylinders was able to be localized to within $7.5\ mm$ in \cite{mark3}.\\

As discussed in Chapter \ref{chap:localiz}, localization is achieved through the use of fiducial markers. The localization of the robot eliminates the need for registration, since the pointclouds can be spatially aligned using the location of the robot at time it takes each scan.\\

\section{Non-Destructive Thickness Estimation}

With two registered pointclouds the distance between them represents the thickness of the applied shotcrete layer. Calculating the distance can be divided in to three main categories, depending on how each pointcloud is treated. In the Point-to-point (P2P) method the pointclouds do not require further processing. The Point-to-mesh (P2M) method requires converting one of the pointclouds to a mesh, and the Mesh-to-mesh (M2M) approach requires converting both pointclouds to meshes.\\

\subsection{Point-to-Point}
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/p2p.pdf}
    \caption{Point-to-Point Thickness Estimation}
    \label{fig:p2pdia}
\end{figure}
The P2P approach is the simplest yet most robust method for thickness estimation. If the initial and final pointclouds are sufficiently dense, it can be the most accurate as well. The P2P method loses accuracy when the surface scans have a significant amount of noise, or low point density. Calculating the shotcrete thickness using P2P is done using the nearest neighbour search method from the PCL library. For each point in the source cloud, the nearest point in the target cloud is found. The distance between the two points is calculated and stored in the final pointcloud used for thickness analysis. To achieve the best results the denser point cloud should be used as the target cloud.\\
\subsection{Point-to-Mesh}
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/p2m.pdf}
    \caption{Point-to-Mesh Thickness Estimation}
    \label{fig:p2mdia}
\end{figure}

The P2M approach requires first generating a mesh of the final pointcloud. The most common approach to forming a mesh from a set of points is Delaunay triangulation. Using this method the points are grouped in threes to form a continuous surface of triangles. The thickness calculation is done by finding the nearest point or edge in the source cloud for each point in the target cloud. The distance is then calculated using a normal vector to the source cloud triangle's plane that intersects the point in the target cloud. As can be seen in Figure \ref{fig:p2mdia}, if the surface meshing is performed at too high a resolution the accuracy is significantly reduced. The original pointcloud can be downsampled using averaging methods to yield a lower resolution pointcloud, however the process requires tuning specific to the surface features it is used upon. As well, different sections of the surface may have significantly different roughness requiring differing degrees of downsampling to yield optimal results.\\
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/p2mlocal.pdf}
    \caption{Point-to-Mesh Thickness Estimation Using Local Features}
    \label{fig:p2mlocaldia}
\end{figure}
To reduce the accuracy loss of using a single density for downsampling the pointcloud, local features can be computed. Local features are computed by averaging a group of points to form a single plane using a method such as the least squares. The least squares method attempts to find a plane having the least distance to each point in the local area. By computing local features, the accuracy loss shown in Figure \ref{fig:p2mdia} can be reduced to the scenario presented in \ref{fig:p2mlocal}. Local features once again requires knowledge of the surface roughness or scan specific tuning. The P2M approaches can provide greater accuracy in low density pointclouds than P2P can offer, but they require tuning and calibration from the operator and an increased amount of computation time.\\
\subsection{Mesh-to-Mesh}
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/m2m.pdf}
    \caption{Mesh-to-Mesh Thickness Estimation}
    \label{fig:m2mdia}
\end{figure}
The M2M approaches are the most computationally intensive methods and have the highest sensitivity to computation parameter selection. Both pointclouds, initial and final, will have different surface roughness and require individual site specific tuning. In M2M, the midpoint of the line (or centroid of the triangle) formed by the meshing of the source pointcloud is used as the location to calculate a thickness measurement. The orthogonal distance from the line (or surface) of the source mesh to the intersection with the line (or surface) of the target mesh is used as the thickness estimate. Similar to P2M, M2M requires specific tuning to ensure the pointclouds are accurately represented as meshes.\\
\subsection{Multiscale Model-to-Model Cloud Comparison}
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\textwidth]{Pics/m3c2.png}
    \caption{Multiscale Model-to-Model Cloud Comparison \cite{accurate3d}}
    \label{fig:m3c2}
\end{figure}

Multiscale Model-to-Model Cloud Comparison (M3C2) is visually summarised in Figure \ref{fig:m3c2}. This approach is similar to the local feature P2M approach in which local areas of the point cloud are averaged to generate planes which normals are used for thickness estimation. The accuracy loss from choosing an inappropriate scale at which to calculate local surface normals is shown in diagram b of Figure \ref{fig:m3c2}. Though M3C2 is also dependant on site specific calibration, the user is able to specify a confidence value for the accuracy of the surface scans ($\sigma_1,\sigma_2$) and the algorithm includes a confidence value for each thickness estimate.\\

\section{Method Implemented for Estimating Thickness}
Ultimately, the user is free to use alternate methods of thickness estimation. Every pointcloud obtained by the MASSS is localized to a common coordinate frame, making it simple to use external software for pointcloud comparison. CloudCompare (https://www.cloudcompare.org/) is an open source 3D point cloud and mesh processing software that can use the output files generated by the MASSS without the need for converting or processing the data. CloudCompare allows the user to calculate shotcrete thickness using a number of different approaches, with whatever computation parameters they choose.\\

For the specific scenario the MASSS was designed to simulate, P2P was determined to be the best approach. It requires the least amount of user input and provides the highest accuracy for the given test conditions. Though CloudCompare provides an external solution for P2P thickness estimation, in the interest of providing a complete package the P2P algorithm was integrated in to the MASSS software package. Future research in which novel thickness estimation techniques are developed can be integrated directly in to the MASSS software package. The user can view and interact with the thickness estimates within the RVIZ environment thanks to the integration of thickness estimation algorithm in the MASSS software package. Due to the modularity of ROS, alternate thickness estimation algorithms can be selected by launching an alternate thickness estimation service either manually or within the ROS launch file.\\